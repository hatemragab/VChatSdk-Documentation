"use strict";(self.webpackChunkVChatSdk_Documentation=self.webpackChunkVChatSdk_Documentation||[]).push([[285],{3905:function(e,n,t){t.d(n,{Zo:function(){return d},kt:function(){return p}});var o=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function r(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?r(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)t=r[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=o.createContext({}),c=function(e){var n=o.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},d=function(e){var n=c(e.components);return o.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(t),p=a,k=m["".concat(l,".").concat(p)]||m[p]||u[p]||r;return t?o.createElement(k,i(i({ref:n},d),{},{components:t})):o.createElement(k,i({ref:n},d))}));function p(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,i=new Array(r);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var c=2;c<r;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},5647:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return d},default:function(){return m}});var o=t(7462),a=t(3366),r=(t(7294),t(3905)),i=["components"],s={},l="Socket",c={unversionedId:"v chat apis to build web system/socket io",id:"v chat apis to build web system/socket io",isDocsHomePage:!1,title:"Socket",description:"I use socket io in backend, so you must use socket io in your front not web socket !",source:"@site/docs/v chat apis to build web system/socket io.md",sourceDirName:"v chat apis to build web system",slug:"/v chat apis to build web system/socket io",permalink:"/VChatSdk-Documentation/docs/v chat apis to build web system/socket io",editUrl:"https://github.com/hatemragab/v_chat_sdk/docs/v chat apis to build web system/socket io.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Message",permalink:"/VChatSdk-Documentation/docs/v chat apis to build web system/messages"},next:{title:"Customer Support",permalink:"/VChatSdk-Documentation/docs/customer_support/customer support"}},d=[{value:"Socket main name space",id:"socket-main-name-space",children:[{value:"socket io events from clint",id:"socket-io-events-from-clint",children:[{value:"<code>join</code> emit with acknowledgment",id:"join-emit-with-acknowledgment",children:[],level:4}],level:3},{value:"socket io on events",id:"socket-io-on-events",children:[{value:"on <code>update_one_room</code>",id:"on-update_one_room",children:[],level:4},{value:"on <code>user_online_changed</code>",id:"on-user_online_changed",children:[],level:4},{value:"on <code>user_typing_changed</code>",id:"on-user_typing_changed",children:[],level:4}],level:3}],level:2},{value:"Socket message name space",id:"socket-message-name-space",children:[{value:"emit <code>join</code>",id:"emit-join",children:[],level:3},{value:"on <code>all_messages</code> event",id:"on-all_messages-event",children:[],level:3},{value:"on <code>new_message</code> event",id:"on-new_message-event",children:[],level:3}],level:2}],u={toc:d};function m(e){var n=e.components,t=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"socket"},"Socket"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"I use socket io in backend, so you must use socket io in your front not ",(0,r.kt)("inlineCode",{parentName:"p"},"web socket !"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"note you can use v chat test server base url is ",(0,r.kt)("inlineCode",{parentName:"p"},"http://170.178.195.150:81/api/v1/"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"connect url is ",(0,r.kt)("inlineCode",{parentName:"p"},"{{baseUrl}}")," without ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/v1/")," so it will be  ",(0,r.kt)("inlineCode",{parentName:"p"},"http://170.178.195.150:81"))),(0,r.kt)("h2",{id:"socket-main-name-space"},"Socket main name space"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"connect data")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{\n        'transports': ['websocket'],\n        'pingTimeout': 5000,\n        'connectTimeout': 5000,\n        'pingInterval': 5000,\n        'extraHeaders': <String, String>{\n          'Authorization': accessToken, \n          \"accept-language\":  currentLocal\n        },\n        'forceNew': true\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"accessToken")," No Bearer token just send the token you can get one from login or register")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"socket can't connect if no ",(0,r.kt)("inlineCode",{parentName:"p"},"accessToken")," provided or not valid access token send")),(0,r.kt)("h3",{id:"socket-io-events-from-clint"},"socket io events from clint"),(0,r.kt)("h4",{id:"join-emit-with-acknowledgment"},(0,r.kt)("inlineCode",{parentName:"h4"},"join")," emit with acknowledgment"),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"once you success connect you should emitWithAck to join, and you will receive rooms data from callback"),(0,r.kt)("li",{parentName:"ol"},"response will be like this")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"res is in map format you don't need to decode it")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "success": true,\n  "data": [\n    {\n      "_id": "61cd92223bd8731be040e11e",\n      "blockerId": null,\n      "groupSetting": null,\n      "updatedAt": 1640862250276,\n      "creatorId": "61cd8fb33bd8731be040e103",\n      "roomType": "single",\n      "lastMessage": {\n        "_id": "61cd922a3bd8731be040e138",\n        "messageType": "text",\n        "messageAttachment": null,\n        "createdAt": 1640862250273,\n        "content": "first",\n        "senderId": "61cd8fb33bd8731be040e103",\n        "senderName": "user1 updated name",\n        "senderImageThumb": "REGISTER_3c651b24-3912-4191-a131-af99292a75f9_THUMB.jpg",\n        "roomId": "61cd92223bd8731be040e11e"\n      },\n      "isOnline": 0,\n      "title": "user2",\n      "peerId": "61cd8ff33bd8731be040e108",\n      "peerEmail": "user2",\n      "thumbImage": "default_user_image.png",\n      "ifPeerReadMyLastMessage": 0,\n      "unReadCount": 0,\n      "roomMembersCount": 2,\n      "isMute": 0\n    }\n  ]\n}\n')),(0,r.kt)("h3",{id:"socket-io-on-events"},"socket io on events"),(0,r.kt)("h4",{id:"on-update_one_room"},"on ",(0,r.kt)("inlineCode",{parentName:"h4"},"update_one_room")),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"this will fire if any room data changed like last message changed or user block me"),(0,r.kt)("li",{parentName:"ol"},"res is in map format you don't need to decode it"),(0,r.kt)("li",{parentName:"ol"},"response will like this")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_id": "61cd92223bd8731be040e11e",\n  "blockerId": null,\n  "groupSetting": null,\n  "updatedAt": 1640862250276,\n  "creatorId": "61cd8fb33bd8731be040e103",\n  "roomType": "single",\n  "lastMessage": {\n    "_id": "61cd922a3bd8731be040e138",\n    "messageType": "text",\n    "messageAttachment": null,\n    "createdAt": 1640862250273,\n    "content": "first",\n    "senderId": "61cd8fb33bd8731be040e103",\n    "senderName": "user1 updated name",\n    "senderImageThumb": "REGISTER_3c651b24-3912-4191-a131-af99292a75f9_THUMB.jpg",\n    "roomId": "61cd92223bd8731be040e11e"\n  },\n  "isOnline": 0,\n  "title": "user2",\n  "peerId": "61cd8ff33bd8731be040e108",\n  "peerEmail": "user2",\n  "thumbImage": "default_user_image.png",\n  "ifPeerReadMyLastMessage": 0,\n  "unReadCount": 0,\n  "roomMembersCount": 2,\n  "isMute": 0\n}\n')),(0,r.kt)("h4",{id:"on-user_online_changed"},"on ",(0,r.kt)("inlineCode",{parentName:"h4"},"user_online_changed")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"this event fire if user become offline or online only in my chats list"),(0,r.kt)("li",{parentName:"ul"},"res is in json format you need to decode it first")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "status": 1,\n  "roomId": "xxx"\n}\n\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"1 for become online"),(0,r.kt)("li",{parentName:"ul"},"0 for offline"),(0,r.kt)("li",{parentName:"ul"})),(0,r.kt)("h4",{id:"on-user_typing_changed"},"on ",(0,r.kt)("inlineCode",{parentName:"h4"},"user_typing_changed")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"res is in map format you don't need to decode it")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'{\n  "status": "",  \n  "name": "",\n  "roomId": ""\n}\n')),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"status")," enum with this data ",'["stop","typing","recording"]'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name")," name of user case this group chat"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"roomId")," room id which has the changes")),(0,r.kt)("h2",{id:"socket-message-name-space"},"Socket message name space"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"you need to connect this if user in message page and manually disconnect if he leaves")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"connect url is ",(0,r.kt)("inlineCode",{parentName:"p"},"{{baseUrl}}")," without ",(0,r.kt)("inlineCode",{parentName:"p"},"/api/v1/")," so it will be  ",(0,r.kt)("inlineCode",{parentName:"p"},"http://170.178.195.150:81/message"))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"you need to connect this socket when user enter the message page")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"connect data")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{\n      'transports': ['websocket'],\n      'pingTimeout': 5000,\n      'connectTimeout': 5000,\n      'pingInterval': 5000,\n      'extraHeaders': <String, String>{\n        'Authorization':  accessToken\n      },\n      'forceNew': true\n    }\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},(0,r.kt)("inlineCode",{parentName:"p"},"accessToken")," No Bearer token just send the token you can get one from login or register\nsocket can't connect if no ",(0,r.kt)("inlineCode",{parentName:"p"},"accessToken")," provided or not valid access token send")),(0,r.kt)("h3",{id:"emit-join"},"emit ",(0,r.kt)("inlineCode",{parentName:"h3"},"join")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"pass ",(0,r.kt)("inlineCode",{parentName:"li"},"roomId")," to its param"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'_socket.emit("join", currentRoomId);'))),(0,r.kt)("h3",{id:"on-all_messages-event"},"on ",(0,r.kt)("inlineCode",{parentName:"h3"},"all_messages")," event"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"res is in json format you need to decode it"),(0,r.kt)("li",{parentName:"ul"},"res will like this")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "_id": "61cd922a3bd8731be040e138",\n    "messageType": "text",\n    "messageAttachment": null,\n    "createdAt": 1640862250273,\n    "content": "first",\n    "senderId": "61cd8fb33bd8731be040e103",\n    "senderName": "user1 updated name",\n    "senderImageThumb": "REGISTER_3c651b24-3912-4191-a131-af99292a75f9_THUMB.jpg",\n    "roomId": "61cd92223bd8731be040e11e"\n  },\n  {\n    "_id": "61cd92223bd8731be040e128",\n    "messageType": "text",\n    "messageAttachment": null,\n    "createdAt": 1640862242839,\n    "content": "first",\n    "senderId": "61cd8fb33bd8731be040e103",\n    "senderName": "user1 updated name",\n    "senderImageThumb": "REGISTER_3c651b24-3912-4191-a131-af99292a75f9_THUMB.jpg",\n    "roomId": "61cd92223bd8731be040e11e"\n  }\n]\n\n')),(0,r.kt)("h3",{id:"on-new_message-event"},"on ",(0,r.kt)("inlineCode",{parentName:"h3"},"new_message")," event"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"res is in json format you need to decode it"),(0,r.kt)("li",{parentName:"ul"},"this event will invoke on evey message you send or receive will invoke for sender and receiver so update your ui one\nyou receive"),(0,r.kt)("li",{parentName:"ul"},"res will like this")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},' {\n  "_id": "61cd922a3bd8731be040e138",\n  "messageType": "text",\n  "messageAttachment": null,\n  "createdAt": 1640862250273,\n  "content": "first",\n  "senderId": "61cd8fb33bd8731be040e103",\n  "senderName": "user1 updated name",\n  "senderImageThumb": "REGISTER_3c651b24-3912-4191-a131-af99292a75f9_THUMB.jpg",\n  "roomId": "61cd92223bd8731be040e11e"\n}\n')),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"don't forget to disconnect from this name space after user leave the message page so i can make received message as un read and send notifications")))}m.isMDXComponent=!0}}]);